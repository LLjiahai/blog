### 图片灰度和反相颜色

>在这个例子里，我们遍历所有像素以改变他们的数值。然后我们将被修改的像素数组通过putImageData()放回到画布中去。invert函数仅仅是去减掉颜色的最大色值255.grayscale函数仅仅是用红绿和蓝的平均值。你也可以用加权平均，例如x = 0.299r + 0.587g + 0.114b这个公式。更多资料请参考维基百科的Grayscale

![default](https://user-images.githubusercontent.com/30850497/48655891-88ec2880-ea58-11e8-8bd9-50b39678b892.jpg)
![1](https://user-images.githubusercontent.com/30850497/48655892-88ec2880-ea58-11e8-89fa-c26876382784.jpg)
![2](https://user-images.githubusercontent.com/30850497/48655893-8984bf00-ea58-11e8-8308-978e78d5d3ef.jpg)

>https://codepen.io/WangShuXian6/pen/NEvdPo

```html
<canvas id='canvas'></canvas>
<button id='invertbtn'>invert</button>
<button id='grayscalebtn'>grayscale</button>
```
```javascript
let data='data:image/jpeg;base64,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'


let img = new Image()
img.src = data
img.onload = function() {
  draw(this)
}

function draw(img) {
  let canvas = document.getElementById('canvas')
  let ctx = canvas.getContext('2d')
  ctx.drawImage(img, 0, 0)
  img.style.display = 'none'
  let imageData = ctx.getImageData(0,0,canvas.width, canvas.height)
  let data = imageData.data
    
  let invert = function() {
   // data 是对  imageData 的引用，故修改 data 会修改  imageData 的值
    for (let i = 0; i < data.length; i += 4) {
      data[i]     = 225 - data[i]    // red
      data[i + 1] = 225 - data[i + 1] // green
      data[i + 2] = 225 - data[i + 2] // blue
    }

  // 将修改后的  imageData 推入 ctx
    ctx.putImageData(imageData, 0, 0)
  }

  let grayscale = function() {
    for (let i = 0; i < data.length; i += 4) {
      let avg = (data[i] + data[i +1] + data[i +2]) / 3
      data[i]     = avg // red
      data[i + 1] = avg // green
      data[i + 2] = avg // blue
    }
    ctx.putImageData(imageData, 0, 0)
  };

  let invertbtn = document.getElementById('invertbtn')
  invertbtn.addEventListener('click', invert)
  let grayscalebtn = document.getElementById('grayscalebtn')
  grayscalebtn.addEventListener('click', grayscale)
}
```